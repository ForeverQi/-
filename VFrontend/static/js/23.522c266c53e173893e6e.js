webpackJsonp([23],{"+7e2":function(t,e,i){t.exports=i.p+"static/img/empty_search_item_icon.1d8fde8.png"},"+KbE":function(t,e){},G3Ts:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("4YfN"),a=i.n(s),n=(i("RJSr"),i("dT7Q")),o=i("0IQH"),l=i("s2Qm"),c=i("b9vL"),r=i("zS0x"),d=i("ZQn7"),u=i("mUeO"),h={name:"videoList",data:function(){return{pageState:0,History:{loading:!1,show:!1,list:[]},keyWord:"",pageLoading:!1,VideoList:{manage:0,curPage:1,pageLimit:30,loading:0,ajaxFinish:0,listData:[],total:0},Classify:{show:!1,conShow:!1,loading:!1,curItem:{id:0,name:"全部"},list:null}}},mounted:function(){var t=this,e=$(window),i=$(document),s=$("#pageMainWrap").find(".no-data-text"),a=i.scrollTop(),n=null;$(document).on("scroll",function(){var i=$(this).scrollTop();clearTimeout(n),a<i&&e.outerHeight()&&e.outerHeight()>=s.offset().top-i&&(a=i,n=setTimeout(function(){t.getVideoListData("add")},200))}),t.$route.query.search_title?(t.keyWord=t.$route.query.search_title,t.enterSearch()):t.$refs.keywordDom.focus()},methods:{gethHistoryData:function(){var t=this;t.History.loading=!0,Object(u.m)({}).then(function(e){t.History.loading=!1,e.cnt&&(t.History.list=e.list)})},showHideHistory:function(t){t&&this.gethHistoryData(),this.History.show=t},delHistory:function(t,e){var i=this,s={};void 0===e?s.all_log=1:s.log_id=t.id,Object(u.n)({log_id:t.id,all_log:1}).then(function(t){o.a.Msg({message:"删除成功!"}),s.log_id?i.History.list.splice(e,1):i.History.list.splice(0,i.History.list.length)})},enterSearch:function(){this.keyWord.length?(this.pageState=1,this.VideoList.listData.splice(0,this.VideoList.listData.length),this.VideoList.ajaxFinish=0,this.VideoList.curPage=1,this.getVideoListData(),this.showHideHistory(!1)):o.a.Msg({message:"请输入关键字"})},selectItemSearch:function(t){this.keyWord=t.name,this.enterSearch()},getVideoListData:function(t){var e=this,i=e.VideoList;i.loading||i.ajaxFinish||(i.loading=!0,console.log(i.curPage),Object(u.E)({limit:i.pageLimit,page:i.curPage,class_id:0,search_title:e.keyWord}).then(function(s){e.pageState=2,i.total=s.total;var a=s.list;a.length?(i.curPage+=1,a.forEach(function(t,e){t.opacity=0,t.left=0,t.top=0,t.height=0,t.col=0,t.selected=0,i.listData.push(t)}),e.$refs.VideoListComponent.counLayout(t)):(i.ajaxFinish=1,i.loading=!1)}).catch(function(t){}))},VideoManageSwitch:function(t){this.Member;var e=this.VideoList;e.listData.length?(e.manage=t,this.$refs.VideoManageBtn.allSelected=0,e.listData.forEach(function(t,e){t.selected=0})):o.a.Msg({message:"当前没有可管理视频"})},selectClassifyShow:function(){this.$refs.selectClassifyLayer.showClassifyLayer(1)},changeVideoClass:function(t,e){if(t&&0!=t.id){var i=this,s=i.VideoList,l={},c=0;s.listData.forEach(function(t,e){t.selected&&!t.del&&(l["video_ids["+e+"]"]=t.id,c++)}),c&&n.a.confirm({className:"video-dialog-alert",message:"确认将所选"+c+'个视频批量转移至分类"'+t.name+'"吗?',confirmButtonColor:"#FF9900"}).then(function(){Object(u.G)(a()({},l,{class_id:t.id})).then(function(a){s.listData.forEach(function(e,i){e.selected&&(e.class_id=t.id,e.selected=0)}),o.a.Msg({message:"转移成功"}),setTimeout(function(){i.VideoList.manage=!1,e(0)},100)})}).catch(function(){})}else o.a.Msg({message:"请选择转移到的分类项"})},goBack:function(){this.$router.push({path:"/shop/bac/video/index"})}},components:{VideoListComponent:l.a,PageHead:c.a,VideoManageBtn:r.a,SelectClassify:d.a}},g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"V-S-P"},[i("div",{staticClass:"page-title-area"},[i("PageHead",{on:{backFun:t.goBack}},[[i("div",{staticClass:"input-box"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.keyWord,expression:"keyWord"}],ref:"keywordDom",attrs:{type:"text",placeholder:"请输入您要搜索的内容"},domProps:{value:t.keyWord},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterSearch(e)},focus:function(e){return t.showHideHistory(!0)},input:function(e){e.target.composing||(t.keyWord=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"btn-box",on:{click:t.enterSearch}},[i("button",[t._v("搜索")])])]],2),t._v(" "),t.VideoList.total?i("div",{staticClass:"head-info-box"},[i("div",{staticClass:"list-count-text"},[t._v("共找到"+t._s(t.VideoList.total)+"个相关视频")]),t._v(" "),i("div",{staticClass:"manage-btn"},[t.VideoList.manage?t._e():i("button",{staticClass:"admin-btn default-btn",on:{click:function(e){return t.VideoManageSwitch(1)}}},[t._v("管理")]),t._v(" "),t.VideoList.manage?i("button",{staticClass:"finish-btn orange-btn",on:{click:function(e){return t.VideoManageSwitch(0)}}},[t._v("完成")]):t._e()])]):t._e()],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.pageState,expression:"pageState"}],staticClass:"page-main-wrap",style:{"margin-top":t.$store.getters.variables.many.BarHeight/2+"px"},attrs:{id:"pageMainWrap"}},[2===t.pageState?i("VideoListComponent",{ref:"VideoListComponent",attrs:{listData:t.VideoList.listData,manage:t.VideoList.manage,listType:"search"}}):t._e(),t._v(" "),t.VideoList.loading?i("span",{staticClass:"loading-icon"}):t._e(),t._v(" "),i("span",{staticClass:"no-data-text",class:t.VideoList.ajaxFinish&&t.VideoList.listData.length?"visible":""},[t._v("没有更多数据了~~")])],1),t._v(" "),i("VideoManageBtn",{directives:[{name:"show",rawName:"v-show",value:t.VideoList.manage,expression:"VideoList.manage"}],ref:"VideoManageBtn",attrs:{listData:t.VideoList.listData}}),t._v(" "),t.History.show?i("div",{staticClass:"search-history",style:{"margin-top":t.$store.getters.variables.many.BarHeight/2+"px"}},[i("dl",[i("dt",[i("strong",[t._v("历史搜索")]),t._v(" "),i("i",{staticClass:"sjzs-icon s-icon-delete",on:{click:t.delHistory}})]),t._v(" "),i("dd",[!t.History.loading&&t.History.list.length?i("ul",{staticClass:"history-list"},t._l(t.History.list,function(e,s){return i("li",{key:e.id,on:{click:function(i){return t.selectItemSearch(e)}}},[i("span",{staticClass:"key-word"},[t._v(t._s(e.name))]),t._v(" "),i("i",{staticClass:"sjzs-icon s-icon-cross",on:{click:function(i){return i.stopPropagation(),t.delHistory(e,s)}}})])}),0):t._e(),t._v(" "),t.History.loading?i("span",{staticClass:"loading-icon"}):t._e(),t._v(" "),t.History.loading||t.History.list.length?t._e():i("div",{staticClass:"history-empty"},[t._v("暂无搜索记录")])])])]):t._e(),t._v(" "),i("SelectClassify",{ref:"selectClassifyLayer",attrs:{title:"选择分类",enterText:"转移至该分类",info:t.Classify.curItem},on:{closeBack:t.changeVideoClass}})],1)},staticRenderFns:[]};var f=i("C7Lr")(h,g,!1,function(t){i("hn+b")},null,null);e.default=f.exports},NORy:function(t,e,i){t.exports=i.p+"static/img/empty_list_item_icon.e6246f7.png"},YLv8:function(t,e){},"hn+b":function(t,e){},s2Qm:function(t,e,i){"use strict";var s={name:"VideoList",props:["listData","manage","listType"],data:function(){return{loading:!1,isFirst:!0,nodeWidth:0,colCount:2,colHeight:[],itemDomArr:null,lastIndex:0}},mounted:function(){this.nodeWidth=this.$refs.listBoxArea.offsetWidth/this.colCount,this.itemDomArr=this.$refs.listBox.children,this.counLayout(0)},methods:{counLayout:function(t){var e=this,i=e.listData;switch(t){case"switchClass":case"del":e.isFirst=!0}"add"!=t&&(e.lastIndex=0),function t(s){if(s<i.length){var a=new Image,n=i[s];a.onerror=a.onload=function(a){"error"===a.type&&(n.conver=e.noPicUrl),n.height=e.itemDomArr[s].offsetHeight,e.waterFall(n),s==i.length-1&&(e.$parent.VideoList.loading=!1),t(e.lastIndex+=1)},a.src=n.conver}}(e.lastIndex)},waterFall:function(t){if(this.isFirst){for(var e=0;e<this.colCount;e++)this.colHeight[e]=0;this.isFirst=!1}var i=0,s=this.colHeight[0];for(e=0;e<this.colHeight.length;e++)this.colHeight[e]<s&&(i=e,s=this.colHeight[e]);t.left=this.nodeWidth*i,t.top=s,t.opacity=1,t.col=i+1,this.colHeight[i]=t.height+this.colHeight[i],this.$refs.listBox&&(this.$refs.listBox.style.height=Math.max.apply(null,this.colHeight)+"px")},goDetail:function(t){var e=0,i="";switch(this.listType){case"list":e=this.$parent.Classify.curItem.id;break;case"search":i=this.$parent.keyWord}this.$router.push({path:"detail",query:{id:t.id,class_id:e,search_title:i}})},VideoSelectItem:function(t){t.selected=1*!t.selected;var e=this.listData.find(function(t){return 0==t.selected});e&&this.$parent.$refs.VideoManageBtn&&(this.$parent.$refs.VideoManageBtn.allSelected=0),!e&&this.$parent.$refs.VideoManageBtn&&(this.$parent.$refs.VideoManageBtn.allSelected=1)}},computed:{}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"listBoxArea",staticClass:"list-box-area",attrs:{id:"listBoxArea"}},[s("ul",{directives:[{name:"show",rawName:"v-show",value:t.listData.length,expression:"listData.length"}],ref:"listBox",staticClass:"list-box"},[t._l(t.listData,function(e,i){return[e.del?t._e():s("li",{class:"list-item list-item-"+e.col,style:{left:e.left+"px",top:e.top+"px",opacity:e.opacity},attrs:{"data-id":e.id,"data-classid":e.class_id}},[e.is_publish?s("span",{staticClass:"state-box",attrs:{"data-state":"up"}},[t._v("已上线")]):t._e(),t._v(" "),e.is_publish?t._e():s("span",{staticClass:"state-box",attrs:{"data-state":"down"}},[t._v("已下架")]),t._v(" "),t.manage?s("span",{staticClass:"sjzs-icon s-icon-duigou-1 radio-select",attrs:{"data-selected":e.selected},on:{click:function(i){return t.VideoSelectItem(e)}}}):t._e(),t._v(" "),s("div",{staticClass:"img-box",on:{click:function(i){return t.goDetail(e)}}},[s("img",{attrs:{src:e.conver,alt:e.description}})]),t._v(" "),s("div",{staticClass:"name-box"},[s("span",[t._v(t._s(e.title))])])])]})],2),t._v(" "),t.listData.length?t._e():s("div",{staticClass:"empty-list-item"},["search"==t.listType?[s("img",{attrs:{src:i("+7e2"),alt:""}}),t._v(" "),s("p",[t._v("没有找到相关内容")])]:[s("img",{attrs:{src:i("NORy"),alt:""}}),t._v(" "),s("p",[t._v("您还没有添加的视频哦")])]],2)])},staticRenderFns:[]};var n=i("C7Lr")(s,a,!1,function(t){i("+KbE")},"data-v-2933edc4",null);e.a=n.exports},zS0x:function(t,e,i){"use strict";var s=i("4YfN"),a=i.n(s),n=(i("RJSr"),i("dT7Q")),o=i("mUeO"),l=i("0IQH"),c={name:"VideoManage",props:["listData"],data:function(){return{allSelected:0}},methods:{VideoListManage:function(t){var e=this,i=e.listData;switch(t){case"select":e.allSelected=1*!e.allSelected,i.forEach(function(t,i){t.selected=e.allSelected});break;case"up":case"down":case"del":case"classify":var s={},c=!1;if(i.forEach(function(t,e){t.selected&&!t.del&&(s["ids["+e+"]"]=t.id,c=!0)}),c)switch(t){case"del":n.a.confirm({className:"video-dialog-alert",message:"确定要删除吗？",confirmButtonColor:"#FF9900"}).then(function(){Object(o.J)(a()({},s)).then(function(t){if(t){for(var s=i.length-1;s>=0;)i[s].selected&&(i[s].del=!0,i.splice(s,1)),s--;l.a.Msg({message:"删除成功"}),e.$parent.$refs.VideoListComponent.counLayout("del")}})}).catch(function(){});break;case"up":case"down":var r=1*("up"===t),d="up"===t?"上架":"下架";n.a.confirm({className:"video-dialog-alert",message:"确定要"+d+"吗？",confirmButtonColor:"#FF9900"}).then(function(){Object(o.K)(a()({},s,{publish:r})).then(function(t){t&&(i.forEach(function(t,e){t.selected&&(t.is_publish=r)}),l.a.Msg({message:d+"成功"}))})}).catch(function(){});break;case"classify":e.$parent.selectClassifyShow()}else l.a.Msg({message:"请选择视频项目进行操作"})}}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"video-manage-btn list-foot"},[i("span",{staticClass:"all-select",on:{click:function(e){return t.VideoListManage("select")}}},[i("i",{staticClass:"sjzs-icon s-icon-duigou-1 radio-select",attrs:{"data-selected":t.allSelected}}),t._v(" "),i("b",[t._v("全选")])]),t._v(" "),i("span",{staticClass:"btn-area"},[i("button",{staticClass:"btn-up",on:{click:function(e){return t.VideoListManage("up")}}},[t._v("\n            上架\n        ")]),t._v(" "),i("button",{staticClass:"btn-down",on:{click:function(e){return t.VideoListManage("down")}}},[t._v("\n            下架\n        ")]),t._v(" "),i("button",{staticClass:"btn-classify",on:{click:function(e){return t.VideoListManage("classify")}}},[t._v("\n            分类\n        ")]),t._v(" "),i("button",{staticClass:"btn-del",on:{click:function(e){return t.VideoListManage("del")}}},[t._v("\n            删除\n        ")])])])},staticRenderFns:[]};var d=i("C7Lr")(c,r,!1,function(t){i("YLv8")},"data-v-73704aa5",null);e.a=d.exports}});
//# sourceMappingURL=23.522c266c53e173893e6e.js.map